离线docker镜像下载地址：http://192.168.66.46:9000/public/docker/ac-openjdk21.tar


导入docker镜像 docker load -i ac-openjdk21.tar


## 启动agent
agent/docker-compose.yml

docker-compose build  编译

docker-compose up -d 启动

docker-compose down 停止



## 启动gateway

gateway/docker-compose.yml

docker-compose build  编译

docker-compose up -d 启动

docker-compose down 停止



# agent 配置文件

```yaml
spring:
  main:
    web-application-type: none
  threads:
    virtual:
      enabled: true
agent:
  client-id: client-001
  # RSocket over WebSocket endpoint of gateway
  gateway-url: ws://nb.usegoods.com:9000/rsocket
  # Default timeout in ms if request not specifies
  default-timeout-ms: 30000

logging:
  level:
    com.achance.gateway.agent: info
    org.springframework.messaging.rsocket: info
    io.rsocket: info
    reactor.netty: info

management:
  endpoints:
    web:
      exposure:
        include: health,metrics


```

+ agent.client-id: client-001  agent客户端id, 保证唯一，和gateway对应
+ agent.gateway-url: ws://nb.usegoods.com:9000/rsocket   gateway网关地址



# gateway 配置
```yaml

server:
  port: 9000

spring:
  rsocket:
    server:
      transport: websocket
      mapping-path: /rsocket

logging:
  file:
    name: /logs/gateway.log
  level:
    com.achance.gateway.gateway: info

gateway:
  proxy:
    default-timeout-ms: 30000
    default-target-base-url: https://httpbin.org
    clients:
      client-001:
        enabled: true
        default-target-base-url: https://httpbin.org
        routes:
          - prefix: /open
            target-base-url: http://127.0.0.1:7001

management:
  endpoints:
    web:
      exposure:
        include: health,metrics
```

+ gateway.proxy.default-timeout-ms: 30000  默认超时时间
+ gateway.proxy.default-target-base-url: https://httpbin.org  默认目标地址, 如果某个路由没有配置目标地址，则使用此地址
+ gateway.proxy.clients.client-001.enabled: true  是否启用此客户端,对应agent 配置的client-id
+ gateway.proxy.clients.client-001.default-target-base-url: https://httpbin.org  此客户端的默认目标地址
+ gateway.proxy.clients.client-001.routes.prefix: /open  此客户端的路由前缀
+ gateway.proxy.clients.client-001.routes.target-base-url: http://127.0.0.1:7001  此客户端的路由目标地址


# 访问示例
curl -X GET http://gateway:9000/proxy/{client-id}/转发路径/1001
转发到  http://127.0.0.1:7001/open/1001  接口